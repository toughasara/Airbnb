{# admin_dashboard.twig #}

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://cdn.tailwindcss.com"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>
		<title>Airbnb Admin Management</title>
	</head>
	<body class="bg-gray-100 h-vh overflow-hidden">
		<header class="hidden relative w-full max-md:flex px-5 justify-around pt-3">
			<div class="flex items-center space-x-2">
				<i data-feather="home" class="w-8 h-8 text-rose-500"></i>
				<span class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-rose-500 to-orange-500">
					LuxStay
				</span>
			</div>
			<button id="menu-btn" class="text-blue-600 focus:outline-none">
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 6h16M4 12h16M4 18h16"></path>
				</svg>
			</button>
			<nav class="w-full h-0 overflow-hidden absolute top-full flex flex-col backdrop-blur-md" id="navToggel">
				<a href="{{ path }}dashboard" class="block py-2.5 w-full text-center rounded transition duration-200 hover-red-800">
					Dashboard
				</a>
				<a href="{{ path }}dashboard" class="block py-2.5 w-full text-center rounded transition duration-200 hover-red-800">
					Anonces
				</a>
				<a href="{{ path }}users" class="block py-2.5 w-full text-center rounded transition duration-200 hover:bg-gray-700">
					Users
				</a>
				<a href="{{ path }}logements" class="block py-2.5 w-full text-center rounded transition duration-200 hover:bg-red-200">
					Logements
				</a>

			</nav>
		</header>

		<div class="min-h-screen flex h-vh">
			<aside class="bg-gray-800 text-white w-64 py-7 px-2 flex flex-col">
				<div class="flex items-center space-x-2 px-4">
					<i data-feather="home" class="w-8 h-8 text-rose-500"></i>
					<span class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-rose-500 to-orange-500">
						LuxStay
					</span>
				</div>
				<nav class="space-y-2 mt-6">
					<a href="{{ path }}dashboard" class="block py-2.5 px-4 rounded bg-gray-700">
						Dashboard
					</a>
					<a href="{{ path }}dashboard" class="block py-2.5 px-4 rounded bg-gray-700">
						Anonces
					</a>
					<a href="{{ path }}users" class="block py-2.5 px-4 rounded hover:bg-gray-700">
						Users
					</a>
					<a href="{{ path }}logements" class="block py-2.5 px-4 rounded hover:bg-gray-700">
						Logements
					</a>

				</nav>
				<div class="border-t border-gray-700 pt-4 mt-6">
					<a href="{{ path }} ../Auth/login" class="block py-2.5 px-4 rounded hover:bg-gray-700 text-red-400 hover:text-red-300 flex items-center">
						<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewbox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd" d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z" clip-rule="evenodd"/>
						</svg>
						<span>Logout</span>
					</a>
				</div>
			</aside>
			<div class="flex-1 flex flex-col overflow-hidden h-screen">
				<main
					class="flex-1 overflow-y-scroll bg-gray-100 p-6">
					<!-- Stats Overview -->
					<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
						<div class="bg-white rounded-lg shadow p-6">
							<h3 class="text-gray-500 text-sm font-medium">Total Anonces</h3>
							<p class="text-3xl font-bold">{{ anonces|length }}
								annonce(s)</p>
							<div class="mt-2">
								<button class="text-green-600 hover:text-green-800 text-sm">Manage Anonces →</button>
							</div>
						</div>
						<div class="bg-white rounded-lg shadow p-6">
							<h3 class="text-gray-500 text-sm font-medium">Valid Anonces</h3>
							<p class="text-3xl font-bold">185</p>
							<div class="mt-2">
								<button class="text-green-600 hover:text-green-800 text-sm">Review Anonces →</button>
							</div>
						</div>
						<div class="bg-white rounded-lg shadow p-6">
							<h3 class="text-gray-500 text-sm font-medium">Active Users</h3>
							<p class="text-3xl font-bold">150</p>
							<div class="mt-2">
								<button class="text-green-600 hover:text-green-800 text-sm">Manage Users →</button>
							</div>
						</div>
					</div>

					<h2 class="text-lg font-semibold text-gray-800 mb-4">Anonces Management</h2>
					{# Conteneur principal avec styles améliorés #}
					<div class="overflow-hidden bg-white shadow-lg rounded-lg">
						<div class="overflow-x-auto">
							<table class="min-w-full divide-y divide-gray-200">
								<thead class="bg-gray-100">
									<tr>
										<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ID</th>
										<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Titre</th>
										<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Description</th>
										<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Catégorie</th>
										<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Prix</th>
										<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Photos</th>
										<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Statut</th>
										<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
									</tr>
								</thead>

								<tbody class="bg-white divide-y divide-gray-200">
									{% for anonce in anonces %}
										<tr class="hover:bg-gray-50 transition-colors duration-200">
											<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ anonce.id }}</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ anonce.title }}</td>
											<td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">{{ anonce.description }}</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ anonce.category }}</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
												{{ anonce.price_per_night }}
												€
											</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
												{% if anonce.photos %}
													<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
														{{ anonce.photos }}
														photo(s)
													</span>
												{% else %}
													<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
														Aucune photo
													</span>
												{% endif %}
											</td>
											<td class="px-6 py-4 whitespace-nowrap">
												{% if anonce.is_validated == FALSE %}
													<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
														En attente
													</span>
												{% else %}
													<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
														is Validé
													</span>
												{% endif %}
											</td>
											<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
												<div class="flex space-x-2">
													<a href="/" class="validate-btn inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 hover:bg-blue-200" data-id="{{ anonce.id }}">
														Valider
													</a>

													<a href="/admin/anonces/delete/{{ anonce.id }}" class="text-red-600 hover:text-red-900" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette annonce ?')">
														<i class="fa-solid fa-trash"></i>
													</a>
												</div>

											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>

						<div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
							<div class="text-sm text-gray-700">
								Total :
								<span class="font-medium">{{ anonces|length }}</span>
								annonce(s)
							</div>
						</div>
					</div>
					{# Pied de table avec compteur #}
					<div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
						<div class="text-sm text-gray-700">
							Total :
							<span class="font-medium">{{ anonces|length }}</span>
							annonce(s)
						</div>
					</div>
				</div>
			</main>
		</div>
		<script>
			const menuBtn = document.getElementById('menu-btn');
			const navToggel = document.getElementById('navToggel');
			menuBtn.addEventListener('click', () => {
			if (navToggel.classList.contains('h-0')) {
			navToggel.classList.remove('h-0');
			navToggel.classList.add('h-auto');
			} else {
			navToggel.classList.remove('h-auto');
			navToggel.classList.add('h-0');
			}
			})


			document.addEventListener("DOMContentLoaded", function () {
			document.querySelectorAll(".validate-btn").forEach(button => {
			button.addEventListener("click", function (event) {
			event.preventDefault();
			let anonceId = this.getAttribute("data-id");

			fetch(`/validat/${anonceId}`, {
			method: "POST",
			headers: {
			"Content-Type": "application/x-www-form-urlencoded"
			}
			}).then(response => response.json()).then(data => {
			if (data.status === "success") {
			this.textContent = "Validé";
			this.classList.remove("bg-blue-100", "text-blue-800");
			this.classList.add("bg-green-100", "text-green-800");
			this.style.pointerEvents = "none";
			} else {
			alert("Validation failed!");
			}
			}).catch(error => console.error("Error:", error));
			});
			});
			});
		</script>
	</body>
</html>
